<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sƒ±nav Analiz Uygulamasƒ±</title>
    <style>
        :root {
            --bg-primary: #f5f7fa;
            --bg-secondary: white;
            --bg-tertiary: #f8fafc;
            --text-primary: #333;
            --text-secondary: #4a5568;
            --text-tertiary: #718096;
            --border-color: #eaeaea;
            --border-light: #e2e8f0;
            --input-bg: white;
            --input-border: #e2e8f0;
            --card-bg: #f8fafc;
            --info-bg: #e6fffa;
            --info-text: #2c7a7b;
            --warning-bg: #fef3c7;
            --warning-text: #92400e;
            --warning-border: #f59e0b;
        }

        body.dark-mode {
            --bg-primary: #1a202c;
            --bg-secondary: #2d3748;
            --bg-tertiary: #374151;
            --text-primary: #e2e8f0;
            --text-secondary: #cbd5e0;
            --text-tertiary: #a0aec0;
            --border-color: #4a5568;
            --border-light: #4a5568;
            --input-bg: #374151;
            --input-border: #4a5568;
            --card-bg: #374151;
            --info-bg: #1e4e4e;
            --info-text: #81e6d9;
            --warning-bg: #744210;
            --warning-text: #fef3c7;
            --warning-border: #f59e0b;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
            position: relative;
        }

        .theme-toggle {
            position: absolute !important;
            top: 30px;
            right: calc(50% - 550px + 30px);
            z-index: 1001;
            background: var(--bg-secondary);
            border: 2px solid var(--border-light);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: transform 0.2s, box-shadow 0.2s, width 0.2s, height 0.2s, top 0.2s, right 0.2s;
            font-size: 22px;
            line-height: 1;
        }

        @media (max-width: 1240px) {
            .theme-toggle {
                right: 30px;
            }
        }
        
        @media (max-width: 768px) {
            .theme-toggle {
                width: 32px;
                height: 32px;
                font-size: 18px;
                top: 20px;
                right: 20px;
            }
        }

        .theme-toggle:hover {
            transform: scale(1.15);
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
        }

        .theme-toggle span {
            color: var(--text-primary);
            transition: color 0.3s;
        }

        body:not(.dark-mode) .theme-toggle span {
            color: #333;
        }

        body.dark-mode .theme-toggle span {
            color: #e2e8f0;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: var(--bg-secondary);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 20px;
            transition: background-color 0.3s;
           
        }
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }
        header h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 600;
        }
        
        /* --- CSS DEƒûƒ∞≈ûƒ∞KLƒ∞ƒûƒ∞ --- */
        .header-help-link {
            display: inline-flex; /* 'inline-block' yerine 'inline-flex' kullanƒ±ldƒ± */
            align-items: center; /* ƒ∞kon ve metni dikeyde ortalar */
            gap: 5px; /* ƒ∞kon ve metin arasƒ±na 5px bo≈üluk ekler */
            margin-top: 8px;
            color: #e0e7ff;
            font-size: 14px;
            /* text-decoration: underline; -- BU SATIR KALDIRILDI */
            cursor: pointer;
            transition: color 0.2s;
        }
        .header-help-link:hover {
            color: white;
        }
        /* --- YENƒ∞ CSS KURALI EKLENDƒ∞ --- */
        /* Sadece metni i√ßeren span'a alt √ßizgi uygular */
        .header-link-text {
            text-decoration: underline;
        }
        /* --- CSS DEƒûƒ∞≈ûƒ∞KLƒ∞ƒûƒ∞ SONU --- */

        .section {
            padding: 25px 30px;
            border-bottom: 1px solid var(--border-color);
            transition: border-color 0.3s;
        }
        .section:last-child {
            border-bottom: none;
        }
        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #dc2626;
            padding-bottom: 10px;
            border-bottom: 2px solid #dc2626;
            display: inline-block;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--text-secondary);
            transition: color 0.3s;
        }
        input[type="text"],
        input[type="number"] {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid var(--input-border);
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s, background-color 0.3s, color 0.3s;
            box-sizing: border-box;
            background-color: var(--input-bg);
            color: var(--text-primary);
        }
        input[type="text"]:focus,
        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }
        .section-row {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
            align-items: center;
        }
        .section-row input[type="text"] {
            flex: 2;
        }
        .section-row input[type="number"] {
            flex: 1;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        .delete-btn {
            background: #e53e3e;
            padding: 8px 12px;
            font-size: 12px;
        }
        .delete-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(229, 62, 62, 0.3);
        }
        
        .edit-btn {
            background: #667eea;
            padding: 8px 12px;
            font-size: 12px;
            margin-left: 5px; 
        }
        .edit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }

        .total-score-display {
            background: var(--info-bg);
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            font-weight: 600;
            color: var(--info-text);
            text-align: center;
            transition: background-color 0.3s, color 0.3s;
        }
        .students-list {
            margin-top: 20px;
        }
        .student-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            padding: 12px;
            background: var(--card-bg);
            border-radius: 8px;
            border: 1px solid var(--border-light);
            align-items: center;
            transition: background-color 0.3s, border-color 0.3s;
            flex-wrap: wrap;
        }
        .student-name {
            font-weight: 600;
            color: var(--text-primary);
            flex: 1;
            transition: color 0.3s;
        }
        .student-scores {
            flex: 2;
            color: var(--text-secondary);
            transition: color 0.3s;
        }
        
        .updated-tag {
            color: var(--text-tertiary);
            font-size: 11px;
            font-style: italic;
            margin-left: 8px;
            margin-right: 8px;
            white-space: nowrap;
            align-self: center;
        }

        .student-total {
            font-weight: 700;
            padding: 6px 12px;
            border-radius: 20px;
            margin-left: 10px;
        }
        .passed {
            background: #c6f6d5;
            color: #22543d;
        }
        .failed {
            background: #fed7d7;
            color: #742a2a;
        }
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .analysis-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            transition: background-color 0.3s;
        }
        .analysis-card h4 {
            margin: 0 0 10px 0;
            color: var(--text-secondary);
            font-size: 16px;
            font-weight: 600;
            transition: color 0.3s;
        }
        .analysis-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            transition: color 0.3s;
        }
        .low-pass-rate {
            color: #e53e3e !important;
        }
        .section-averages {
            margin-top: 20px;
        }
        .section-average-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
            transition: border-color 0.3s;
        }
        .section-average-item:last-child {
            border-bottom: none;
        }
        .section-name {
            font-weight: 600;
            color: var(--text-secondary);
            transition: color 0.3s;
        }
        .error {
            color: #e53e3e;
            font-size: 12px;
            margin-top: 5px;
        }
        .warning-banner {
            background-color: var(--warning-bg);
            color: var(--warning-text);
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 13px;
            border-left: 4px solid var(--warning-border);
            display: none;
            transition: background-color 0.3s, color 0.3s;
        }
        .locked {
            background-color: var(--card-bg) !important;
            cursor: not-allowed !important;
            opacity: 0.6;
        }
        .generate-report-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 20px auto;
            display: block;
        }
        .generate-report-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.3);
        }
        
        .app-footer {
            max-width: 1200px;
            margin: 0 auto;
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            border-radius: 12px;
            padding: 25px 30px;
            box-shadow: 0 4px 20px rgba(249, 115, 22, 0.3);
        }
        .footer-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .footer-btn {
            background: linear-gradient(135deg, #fb923c 0%, #f97316 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 0;
            box-shadow: 0 2px 8px rgba(251, 146, 60, 0.2);
        }
        .footer-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(251, 146, 60, 0.5);
            background: linear-gradient(135deg, #fdba74 0%, #fb923c 100%);
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1010;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .modal-content {
            background: var(--bg-secondary);
            margin: 8% auto;
            padding: 0;
            border-radius: 16px;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(249, 115, 22, 0.3);
            animation: slideDown 0.3s;
            overflow: hidden;
            border: 2px solid var(--border-light);
            transition: background-color 0.3s, border-color 0.3s;
        }
        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-header {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            color: white;
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-header h2 {
            margin: 0;
            font-size: 22px;
            font-weight: 600;
        }
        .close {
            color: white;
            font-size: 32px;
            font-weight: 300;
            cursor: pointer;
            transition: transform 0.2s;
            line-height: 1;
        }
        .close:hover {
            transform: rotate(90deg);
        }
        .modal-body {
            padding: 25px;
            color: var(--text-primary);
            line-height: 1.8;
            font-size: 15px;
            transition: color 0.3s;
        }
        
        @media print {
            body {
                background-color: white;
                padding: 0;
            }
            .container {
                box-shadow: none;
                max-width: 100%;
            }
            button, .theme-toggle {
                display: none !important;
            }
            .warning-banner, .app-footer {
                display: none !important;
            }
            .section {
                page-break-inside: avoid;
            }
            header {
                background: #667eea !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .analysis-card {
                break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <button class="theme-toggle" id="themeToggle" aria-label="Tema Deƒüi≈ütir">
        <span id="sunIcon">‚òÄÔ∏é</span>
        <span id="moonIcon" style="display:none;">‚òæ</span>
    </button>

    <div class="container">
        <header>
            <h1>Sƒ±nav Analiz Uygulamasƒ±</h1>
            <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
                <div class="header-help-link" id="headerHowToLink">
                    <span>üìñ</span>
                    <span class="header-link-text">Nasƒ±l Kullanƒ±lƒ±r?</span>
                </div>
                <div class="header-help-link" id="headerDeveloperLink">
                    <span>üë®‚Äçüíª</span>
                    <span class="header-link-text">Geli≈ütirici Hakkƒ±nda</span>
                </div>
                <div class="header-help-link" id="headerPrivacyLink">
                    <span>üîí</span>
                    <span class="header-link-text">Gizlilik</span>
                </div>
            </div>
            </header>
        <section class="section">
            <h2 class="section-title">1. Sƒ±nav Bilgileri</h2>
            <div class="form-group">
                <label for="schoolName">Okul Adƒ±:</label>
                <input type="text" id="schoolName" placeholder="Okul adƒ±nƒ± girin">
            </div>
            <div class="form-group">
                <label for="academicYear">Akademik Yƒ±l:</label>
                <input type="text" id="academicYear" placeholder="√∂rn. 2024-2025">
            </div>
            <div class="form-group">
                <label for="className">Sƒ±nƒ±f Adƒ±:</label>
                <input type="text" id="className" placeholder="√∂rn. 9-A, 10-B">
            </div>
            <div class="form-group">
                <label for="courseName">Ders Adƒ±:</label>
                <input type="text" id="courseName" placeholder="Ders adƒ±nƒ± girin">
            </div>
            <div class="form-group">
                <label for="examName">Sƒ±nav ve D√∂nem Adƒ±:</label>
                <input type="text" id="examName" placeholder="Sƒ±nav ve d√∂nem adƒ±nƒ± girin">
            </div>
            <div class="form-group">
                <label for="teacherName">√ñƒüretmen Adƒ±:</label>
                <input type="text" id="teacherName" placeholder="√ñƒüretmen adƒ±nƒ± girin">
            </div>
            <div class="form-group">
                <label for="passingCriteria">Ge√ßme Kriteri (Puan):</label>
                <input type="number" id="passingCriteria" min="0" placeholder="Ge√ßme puanƒ±nƒ± girin">
                <div class="error" id="passingCriteriaError"></div>
            </div>
        </section>
        <section class="section">
            <h2 class="section-title">2. Sƒ±nav B√∂l√ºmleri</h2>
            <div id="sectionsContainer">
                <div class="section-row">
                    <input type="text" placeholder="B√∂l√ºm adƒ± (√∂rn. A)" class="section-name-input">
                    <input type="number" placeholder="Toplam puan" class="section-score-input" min="0">
                    <button class="delete-btn remove-section">Sil</button>
                </div>
            </div>
            <button id="addSectionBtn">Ba≈üka B√∂l√ºm Ekle</button>
            <div class="total-score-display" id="totalScoreDisplay">
                Toplam Sƒ±nav Puanƒ±: 0 puan
            </div>
            <div class="warning-banner" id="lockWarningBanner">
                ‚ö†Ô∏è √ñƒürenci bilgileri girildikten sonra ge√ßme kriterleri ve sƒ±nav b√∂l√ºmleri deƒüi≈ütirilemez. Deƒüi≈üiklik yapmak i√ßin sayfayƒ± yeniden y√ºklemelisiniz.
            </div>
        </section>
        <section class="section">
            <h2 class="section-title">3. √ñƒürenci Puanlarƒ±</h2>
            <div class="form-group">
                <label for="studentName">√ñƒürenci Adƒ±:</label>
                <input type="text" id="studentName" placeholder="√ñƒürenci adƒ±nƒ± girin">
            </div>
            <div id="studentSectionsContainer"></div>
            <div style="display: flex; gap: 10px; align-items: center;">
                <button id="addStudentBtn">√ñƒürenci Ekle</button>
                <button id="toggleAdvancedBtn" style="background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); margin-left: auto;">
                    üîß Geli≈ümi≈ü Se√ßenekler
                </button>
            </div>
            
            <div id="advancedImportSection" style="display: none; margin-top: 15px; padding: 15px; background: var(--card-bg); border-radius: 8px; border: 2px solid var(--border-light); transition: background-color 0.3s, border-color 0.3s;">
                <h4 style="margin: 0 0 10px 0; color: var(--text-secondary);">üì• CSV Dosyasƒ±ndan ƒ∞√ße Aktar</h4>
                <p style="font-size: 13px; color: var(--text-tertiary); margin-bottom: 10px;">
                    CSV dosyanƒ±z ≈üu formatta olmalƒ±dƒ±r: ƒ∞lk s√ºtun √∂ƒürenci adƒ±, sonraki s√ºtunlar her b√∂l√ºm i√ßin puanlar
                </p>
                <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
                <button id="importCsvBtn" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                    üìÇ CSV Dosyasƒ± Se√ß ve ƒ∞√ße Aktar
                </button>
                <div id="csvImportStatus" style="margin-top: 10px; font-size: 13px;"></div>
                
                <hr style="margin: 15px 0; border: none; border-top: 1px solid var(--border-light);">
                
                <h4 style="margin: 0 0 10px 0; color: var(--text-secondary);">üóëÔ∏è Toplu Silme ƒ∞≈ülemleri</h4>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button id="deleteAllStudentsBtn" style="background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);">
                        ‚ùå T√ºm √ñƒürencileri Sil
                    </button>
                    <button id="clearFormBtn" style="background: linear-gradient(135deg, #7c2d12 0%, #92400e 100%);">
                        üóëÔ∏è Formu Tamamen Temizle
                    </button>
                </div>
            </div>
            
            <div class="students-list" id="studentsList"></div>
        </section>
        <section class="section">
            <h2 class="section-title">4. Sƒ±nav Analizi</h2>
            <div class="analysis-grid">
                <div class="analysis-card">
                    <h4>Sƒ±nƒ±f Ortalamasƒ±</h4>
                    <div class="analysis-value" id="classAverage">0.00</div>
                </div>
                <div class="analysis-card">
                    <h4>Ortanca</h4>
                    <div class="analysis-value" id="medianScore">0.00</div>
                </div>
                <div class="analysis-card">
                    <h4>Toplam √ñƒürenci</h4>
                    <div class="analysis-value" id="totalStudents">0</div>
                </div>
                <div class="analysis-card">
                    <h4>Ba≈üarƒ±lƒ± √ñƒürenciler</h4>
                    <div class="analysis-value" id="successfulStudents">0</div>
                </div>
                <div class="analysis-card">
                    <h4>Ba≈üarƒ±sƒ±z √ñƒürenciler</h4>
                    <div class="analysis-value" id="unsuccessfulStudents">0</div>
                </div>
                <div class="analysis-card">
                    <h4>Ge√ßme Oranƒ±</h4>
                    <div class="analysis-value" id="passRate">0.00%</div>
                </div>
                <div class="analysis-card">
                    <h4>Standart Sapma</h4>
                    <div class="analysis-value" id="stdDeviation">0.00</div>
                </div>
                <div class="analysis-card">
                    <h4>Aralƒ±k</h4>
                    <div class="analysis-value" id="scoreRange">0.00</div>
                </div>
                <div class="analysis-card">
                    <h4>En Y√ºksek Puan</h4>
                    <div class="analysis-value" id="highestScore">0.00</div>
                </div>
                <div class="analysis-card">
                    <h4>En D√º≈ü√ºk Puan</h4>
                    <div class="analysis-value" id="lowestScore">0.00</div>
                </div>
                <div class="analysis-card">
                    <h4>En Zorlu B√∂l√ºm</h4>
                    <div class="analysis-value" id="hardestSection">-</div>
                </div>
                <div class="analysis-card">
                    <h4>En Kolay B√∂l√ºm</h4>
                    <div class="analysis-value" id="easiestSection">-</div>
                </div>
            </div>
        </section>
        <section class="section">
            <h2 class="section-title">5. Sƒ±nav Deƒüerlendirmesi</h2>
            <div class="section-averages" id="sectionAverages">
                <h4>B√∂l√ºm Ortalamalarƒ±:</h4>
                <div id="sectionAveragesList"></div>
            </div>
            <div style="margin-top: 25px;">
                <h4 style="color: var(--text-secondary); margin-bottom: 15px;">Otomatik Deƒüerlendirme:</h4>
                <div id="autoEvaluation" style="background: var(--card-bg); padding: 20px; border-radius: 10px; border-left: 4px solid #667eea; line-height: 1.8; color: var(--text-primary); transition: background-color 0.3s, color 0.3s;">
                    <em style="color: var(--text-tertiary);">Otomatik deƒüerlendirme olu≈üturmak i√ßin √∂ƒürenci ekleyin...</em>
                </div>
            </div>
        </section>
        <div style="text-align: center; padding: 30px;">
            <button class="generate-report-btn" id="generateReportBtn">
                üìÑ PDF Raporu Olu≈ütur
            </button>
        </div>
    </div>

    <footer class="app-footer">
        <div class="footer-buttons">
            <button class="footer-btn" id="aboutBtn">
                <span>‚ÑπÔ∏è</span> Hakkƒ±nda
            </button>
            <button class="footer-btn" id="howToBtn">
                <span>üìñ</span> Nasƒ±l Kullanƒ±lƒ±r
            </button>
            <button class="footer-btn" id="contactBtn">
                <span>üìß</span> ƒ∞leti≈üim
            </button>
            <button class="footer-btn" id="updateBtn">
                <span>üîÑ</span> G√ºncelleme Bilgileri
            </button>
        </div>
    </footer>

    <div id="aboutModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Hakkƒ±nda</h2>
                <span class="close" data-modal="aboutModal">&times;</span>
            </div>
            <div class="modal-body">
                <p>Sƒ±nav Analiz Uygulamasƒ±, √∂ƒüretmenlerin sƒ±nav sonu√ßlarƒ±nƒ± kapsamlƒ± bir ≈üekilde analiz etmelerine yardƒ±mcƒ± olmak i√ßin geli≈ütirilmi≈ü modern ve kullanƒ±cƒ± dostu bir platformdur.</p>
            </div>
        </div>
    </div>

    <div id="howToModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Nasƒ±l Kullanƒ±lƒ±r</h2>
                <span class="close" data-modal="howToModal">&times;</span>
            </div>
            <div class="modal-body">
                <p>Burada nasƒ±l kullanƒ±lacaƒüƒ±nƒ± a√ßƒ±klƒ±yoruz.</p>
            </div>
        </div>
    </div>

    <div id="contactModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ƒ∞leti≈üim</h2>
                <span class="close" data-modal="contactModal">&times;</span>
            </div>
            <div class="modal-body">
                <p>Sorularƒ±nƒ±z, √∂nerileriniz veya destek talepleriniz i√ßin bizimle ileti≈üime ge√ßebilirsiniz. Size yardƒ±mcƒ± olmaktan mutluluk duyarƒ±z.</p>
            </div>
        </div>
    </div>

    <div id="updateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>G√ºncelleme Bilgileri</h2>
                <span class="close" data-modal="updateModal">&times;</span>
            </div>
            <div class="modal-body">
                <p>S√ºr√ºm 2.0 - Uygulama s√ºrekli olarak geli≈ütirilmekte ve yeni √∂zellikler eklenmektedir. En son g√ºncellemeler i√ßin bu b√∂l√ºm√º d√ºzenli olarak kontrol edin.</p>
            </div>
        </div>
    </div>

    <div id="developerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Geli≈ütirici Hakkƒ±nda</h2>
                <span class="close" data-modal="developerModal">&times;</span>
            </div>
            <div class="modal-body">
                <p>Bu uygulama, eƒüitimcilerin hayatƒ±nƒ± kolayla≈ütƒ±rmak amacƒ±yla [Buraya Geli≈ütirici Adƒ±/Bilgisi Eklenebilir] tarafƒ±ndan tasarlanmƒ±≈ü ve kodlanmƒ±≈ütƒ±r.</p>
                <p>Teknoloji ve eƒüitimi bir araya getirme tutkusuyla geli≈ütirilmeye devam etmektedir.</p>
            </div>
        </div>
    </div>

     <div id="privacyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Gizlilik</h2>
                <span class="close" data-modal="privacyModal">&times;</span>
            </div>
            <div class="modal-body">
                <p>Girilen veriler herhangi bir sunucuda depolanmamaktadƒ±r. Sayfa yenilendiƒüi takdirde bu veriler formdan temizlenir.</p>
                <p>Buraya bir ba≈üka √∂rnek metin gelecek.</p>
            </div>
        </div>
    </div>

    <script>
        // Theme Toggle Functionality
        const themeToggle = document.getElementById('themeToggle');
        const sunIcon = document.getElementById('sunIcon');
        const moonIcon = document.getElementById('moonIcon');
        const body = document.body;

        // Check for saved theme preference or default to 'light'
        const currentTheme = localStorage.getItem('theme') || 'light';
        if (currentTheme === 'dark') {
            body.classList.add('dark-mode');
            sunIcon.style.display = 'none';
            moonIcon.style.display = 'block';
        }

        themeToggle.addEventListener('click', function() {
            body.classList.toggle('dark-mode');
            
            if (body.classList.contains('dark-mode')) {
                sunIcon.style.display = 'none';
                moonIcon.style.display = 'block';
                localStorage.setItem('theme', 'dark');
            } else {
                sunIcon.style.display = 'block';
                moonIcon.style.display = 'none';
                localStorage.setItem('theme', 'light');
            }
        });

        let examSections = [];
        let students = [];
        let totalExamScore = 0;
        let isLocked = false;
        
        let isEditing = false;
        let editingIndex = -1;

        const sectionsContainer = document.getElementById('sectionsContainer');
        const totalScoreDisplay = document.getElementById('totalScoreDisplay');
        const addSectionBtn = document.getElementById('addSectionBtn');
        const studentSectionsContainer = document.getElementById('studentSectionsContainer');
        const addStudentBtn = document.getElementById('addStudentBtn');
        const studentsList = document.getElementById('studentsList');
        const passingCriteriaInput = document.getElementById('passingCriteria');
        const passingCriteriaError = document.getElementById('passingCriteriaError');
        const generateReportBtn = document.getElementById('generateReportBtn');
        const csvFileInput = document.getElementById('csvFileInput');
        const importCsvBtn = document.getElementById('importCsvBtn');
        const csvImportStatus = document.getElementById('csvImportStatus');
        const toggleAdvancedBtn = document.getElementById('toggleAdvancedBtn');
        const advancedImportSection = document.getElementById('advancedImportSection');

        toggleAdvancedBtn.addEventListener('click', function() {
            if (advancedImportSection.style.display === 'none') {
                advancedImportSection.style.display = 'block';
                toggleAdvancedBtn.innerHTML = 'üîº Geli≈ümi≈ü Se√ßenekleri Gizle';
            } else {
                advancedImportSection.style.display = 'none';
                toggleAdvancedBtn.innerHTML = 'üîß Geli≈ümi≈ü Se√ßenekler';
            }
        });

        document.getElementById('deleteAllStudentsBtn').addEventListener('click', function() {
            if (students.length === 0) {
                alert('Silinecek √∂ƒürenci bulunmamaktadƒ±r.');
                return;
            }
            if (confirm(`T√ºm √∂ƒürencileri (${students.length} √∂ƒürenci) silmek istediƒüinizden emin misiniz? Bu i≈ülem geri alƒ±namaz!`)) {
                students = [];
                cancelEditing(); 
                unlockFields();
                displayStudents();
                updateAnalysis();
                alert('T√ºm √∂ƒürenciler ba≈üarƒ±yla silindi.');
            }
        });

        document.getElementById('clearFormBtn').addEventListener('click', function() {
            if (confirm('Formu tamamen temizlemek istediƒüinizden emin misiniz? T√ºm √∂ƒürenci bilgileri, sƒ±nav b√∂l√ºmleri ve sƒ±nav bilgileri silinecektir. Bu i≈ülem geri alƒ±namaz!')) {
                students = [];
                examSections = [];
                sectionsContainer.innerHTML = `
                    <div class="section-row">
                        <input type="text" placeholder="B√∂l√ºm adƒ± (√∂rn. A)" class="section-name-input">
                        <input type="number" placeholder="Toplam puan" class="section-score-input" min="0">
                        <button class="delete-btn remove-section">Sil</button>
                    </div>
                `;
                
                document.getElementById('schoolName').value = '';
                document.getElementById('academicYear').value = '';
                document.getElementById('className').value = '';
                document.getElementById('courseName').value = '';
                document.getElementById('examName').value = '';
                document.getElementById('teacherName').value = '';
                document.getElementById('passingCriteria').value = '';
                document.getElementById('passingCriteriaError').textContent = '';
                document.getElementById('studentName').value = '';
                csvImportStatus.innerHTML = '';
                
                cancelEditing(); 
                unlockFields();
                updateSectionInputs();
                displayStudents();
                updateAnalysis();
                
                alert('Form ba≈üarƒ±yla temizlendi.');
            }
        });

        document.getElementById('aboutBtn').addEventListener('click', function() {
            document.getElementById('aboutModal').style.display = 'block';
        });

        document.getElementById('howToBtn').addEventListener('click', function() {
            document.getElementById('howToModal').style.display = 'block';
        });

        document.getElementById('contactBtn').addEventListener('click', function() {
            document.getElementById('contactModal').style.display = 'block';
        });

        document.getElementById('updateBtn').addEventListener('click', function() {
            document.getElementById('updateModal').style.display = 'block';
        });

        document.querySelectorAll('.close').forEach(function(closeBtn) {
            closeBtn.addEventListener('click', function() {
                const modalId = this.getAttribute('data-modal');
                document.getElementById(modalId).style.display = 'none';
            });
        });

        window.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            updateSectionInputs();
            updateTotalScore();
            updateAnalysis();
            
            document.getElementById('headerHowToLink').addEventListener('click', function() {
                document.getElementById('howToModal').style.display = 'block';
            });

            document.getElementById('headerDeveloperLink').addEventListener('click', function() {
                document.getElementById('developerModal').style.display = 'block';
            });

             document.getElementById('headerPrivacyLink').addEventListener('click', function() {
                document.getElementById('privacyModal').style.display = 'block';
            });

        });

        function generateReport() {
            if (students.length === 0) {
                alert('L√ºtfen rapor olu≈üturmadan √∂nce en az bir √∂ƒürenci ekleyin.');
                return;
            }
            updateAnalysis();
            const printWindow = window.open('', '_blank');
            const schoolName = document.getElementById('schoolName').value || 'Okul Adƒ±';
            const academicYear = document.getElementById('academicYear').value || 'Akademik Yƒ±l';
            const className = document.getElementById('className').value || 'Sƒ±nƒ±f Adƒ±';
            const courseName = document.getElementById('courseName').value || 'Ders Adƒ±';
            const examName = document.getElementById('examName').value || 'Sƒ±nav Adƒ±';
            const teacherName = document.getElementById('teacherName').value || '√ñƒüretmen Adƒ±';

            const totalScores = students.map(student => student.scores.reduce((sum, score) => sum + score, 0));
            const classAverage = (totalScores.reduce((sum, score) => sum + score, 0) / students.length) || 0;

            const passingCriteria = parseFloat(document.getElementById('passingCriteria').value) || 0;
            let studentsTableHTML = `
                <div class="section">
                    <h2 class="section-title">√ñƒürenci Puanlarƒ±</h2>
                    <table class="student-table">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>√ñƒürenci Adƒ±</th>`;
            examSections.forEach(section => {
                studentsTableHTML += `<th>${section.name}</th>`;
            });
           studentsTableHTML += `
                                <th>Toplam</th>
                                <th>Ort. Sapma</th> 
                                <th>Durum</th>
                            </tr>
                        </thead>
                        <tbody>`;
           
            students.forEach((student, index) => {
                const totalScore = student.scores.reduce((sum, score) => sum + score, 0);
                const isPassed = totalScore >= passingCriteria;
                const statusText = isPassed ? 'Ba≈üarƒ±lƒ±' : 'ƒ∞yile≈ütirme Gerekiyor';
                
                const deviation = totalScore - classAverage;
                const deviationText = deviation > 0 ? `+${deviation.toFixed(2)}` : deviation.toFixed(2);
                const deviationColor = deviation > 0 ? '#22543d' : (deviation < 0 ? '#742a2a' : '#4a5568');

                studentsTableHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td><strong>${student.name}</strong>${student.updated ? ' <em style="color: #718096; font-size: 10px;">*</em>' : ''}</td>`;
                
                student.scores.forEach(score => {
                    studentsTableHTML += `<td>${score}</td>`;
                });

                studentsTableHTML += `
                        <td><strong>${totalScore}</strong></td>
                        <td style="color: ${deviationColor}; font-weight: 600;">${deviationText}</td>
                        <td>
                            <span style="padding: 2px 8px; border-radius: 10px; font-size: 11px; background: ${isPassed ? '#c6f6d5' : '#fed7d7'}; color: ${isPassed ? '#22543d' : '#742a2a'};">${statusText}</span>
                        </td>
                    </tr>`;
            });

            studentsTableHTML += `</tbody></table></div>`;
            const analysisTableHTML = `
                <div class="section">
                    <h2 class="section-title">Sƒ±nav Analizi</h2>
                    <div class="analysis-table-container">
                        <div class="analysis-column">
                            <table class="analysis-table">
                                <thead>
                                    <tr>
                                        <th>Metrik</th>
                                        <th>Deƒüer</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Toplam √ñƒürenci</strong></td>
                                        <td>${document.getElementById('totalStudents').textContent}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Sƒ±nƒ±f Ortalamasƒ±</strong></td>
                                        <td>${document.getElementById('classAverage').textContent}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Ortanca</strong></td>
                                        <td>${document.getElementById('medianScore').textContent}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Standart Sapma</strong></td>
                                        <td>${document.getElementById('stdDeviation').textContent}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Aralƒ±k</strong></td>
                                        <td>${document.getElementById('scoreRange').textContent}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Ge√ßme Oranƒ±</strong></td>
                                        <td>${document.getElementById('passRate').textContent}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="analysis-column">
                            <table class="analysis-table">
                                <thead>
                                    <tr>
                                        <th>Metrik</th>
                                        <th>Deƒüer</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Ba≈üarƒ±lƒ± √ñƒürenciler</strong></td>
                                        <td>${document.getElementById('successfulStudents').textContent}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Ba≈üarƒ±sƒ±z √ñƒürenciler</strong></td>
                                        <td>${document.getElementById('unsuccessfulStudents').textContent}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>En Y√ºksek Puan</strong></td>
                                        <td>${document.getElementById('highestScore').textContent}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>En D√º≈ü√ºk Puan</strong></td>
                                        <td>${document.getElementById('lowestScore').textContent}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>En Zorlu B√∂l√ºm</strong></td>
                                        <td>${document.getElementById('hardestSection').textContent}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>En Kolay B√∂l√ºm</strong></td>
                                        <td>${document.getElementById('easiestSection').textContent}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <h4 style="color: #4a5568; margin-bottom: 12px; font-size: 16px;">B√∂l√ºm Ortalamalarƒ±:</h4>
                        ${document.getElementById('sectionAveragesList').innerHTML}
                    </div>
                </div>`;
            const evaluationHTML = `
                <div class="section">
                    <h2 class="section-title">Sƒ±nav Deƒüerlendirmesi</h2>
                    <div class="evaluation-text">
                        ${document.getElementById('autoEvaluation').innerHTML}
                    </div>
                </div>`;
            printWindow.document.write(`
                <!DOCTYPE html>
                <html lang="tr">
                <head>
                    <meta charset="UTF-8">
                    <title>Sƒ±nav Analiz Raporu</title>
                    <style>
                        body {
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                            margin: 35px;
                            color: #333;
                            line-height: 1.5;
                            font-size: 12px;
                        }
                        .report-header {
                            text-align: center;
                            margin-bottom: 20px;
                            padding-bottom: 15px;
                            border-bottom: 2px solid #667eea;
                        }
                        .report-header h1 {
                            font-size: 24px;
                            margin: 0 0 5px 0;
                        }
                        .report-info {
                            background: #f8fafc;
                            padding: 15px;
                            border-radius: 6px;
                            margin-bottom: 20px;
                            border-left: 3px solid #667eea;
                            font-size: 13px;
                        }
                        .info-grid {
                            display: grid;
                            grid-template-columns: 1fr 1fr;
                            gap: 15px;
                        }
                        .info-column {
                            display: flex;
                            flex-direction: column;
                        }
                        .info-row {
                            display: flex;
                            padding: 6px 0;
                            border-bottom: 1px solid #e2e8f0;
                            font-size: 13px;
                        }
                        .info-row:last-child {
                            border-bottom: none;
                        }
                        .info-label {
                            font-weight: 600;
                            color: #4a5568;
                            min-width: 140px;
                        }
                        .info-value {
                            color: #2d3748;
                        }
                        .section {
                            margin-bottom: 25px;
                        }
                        .section-title {
                            font-size: 18px;
                            font-weight: 600;
                            margin-bottom: 15px;
                            color: #4a5568;
                            padding-bottom: 8px;
                            border-bottom: 2px solid #667eea;
                        }
                        .analysis-table-container {
                            display: grid;
                            grid-template-columns: 1fr 1fr;
                            gap: 15px;
                        }
                        .analysis-column {
                            display: flex;
                            flex-direction: column;
                        }
                        .analysis-table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-top: 10px;
                            font-size: 12px;
                        }
                        .analysis-table th {
                            padding: 8px;
                            text-align: left;
                            border: 1px solid #ddd;
                            background: #667eea;
                            color: white;
                        }
                        .analysis-table td {
                            padding: 6px;
                            border: 1px solid #ddd;
                        }
                        .evaluation-text {
                            font-size: 13px;
                            line-height: 1.6;
                            background: #f8fafc;
                            padding: 15px;
                            border-radius: 8px;
                            border-left: 3px solid #667eea;
                        }
                        .section-average-item {
                            display: flex;
                            justify-content: space-between;
                            padding: 6px 0;
                            border-bottom: 1px solid #e2e8f0;
                            font-size: 13px;
                        }
                        .section-average-item:last-child {
                            border-bottom: none;
                        }
                        .section-name {
                            font-weight: 600;
                            color: #4a5568;
                        }
                        .student-table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-top: 10px;
                            font-size: 12px;
                        }
                        .student-table th {
                            padding: 8px;
                            text-align: left;
                            border: 1px solid #ddd;
                            background: #667eea;
                            color: white;
                        }
                        .student-table td {
                            padding: 6px;
                            border: 1px solid #ddd;
                        }
                        .report-footer {
                            text-align: center;
                            margin-top: 30px;
                            padding-top: 20px;
                            border-top: 1px solid #eaeaea;
                            font-size: 14px;
                        }
                    </style>
                </head>
                <body>
                    <div class="report-header">
                        <h1>Sƒ±nav Analiz Raporu</h1>
                    </div>
                    <div class="report-info">
                        <div class="info-grid">
                            <div class="info-column">
                                <div class="info-row">
                                    <div class="info-label">Okul:</div>
                                    <div class="info-value">${schoolName}</div>
                                </div>
                                <div class="info-row">
                                    <div class="info-label">Akademik Yƒ±l:</div>
                                    <div class="info-value">${academicYear}</div>
                                </div>
                                <div class="info-row">
                                    <div class="info-label">Sƒ±nƒ±f:</div>
                                    <div class="info-value">${className}</div>
                                </div>
                            </div>
                            <div class="info-column">
                                <div class="info-row">
                                    <div class="info-label">Ders:</div>
                                    <div class="info-value">${courseName}</div>
                                </div>
                                <div class="info-row">
                                    <div class="info-label">Sƒ±nav:</div>
                                    <div class="info-value">${examName}</div>
                                </div>
                                <div class="info-row">
                                    <div class="info-label">Ge√ßme Kriteri:</div>
                                    <div class="info-value">${passingCriteria} puan</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    ${analysisTableHTML}
                    ${evaluationHTML}
                    ${studentsTableHTML}
                    <div class="report-footer">
                        <div style="margin-top: 50px; font-weight: 600;">
                            ${teacherName}
                        </div>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.focus();
            setTimeout(() => { printWindow.print(); }, 500);
        }

        generateReportBtn.addEventListener('click', generateReport);

        importCsvBtn.addEventListener('click', function() {
            if (examSections.length === 0) {
                csvImportStatus.innerHTML = '<span style="color: #e53e3e;">‚ö†Ô∏è √ñnce sƒ±nav b√∂l√ºmlerini tanƒ±mlamalƒ±sƒ±nƒ±z!</span>';
                return;
            }
            csvFileInput.click();
        });

        csvFileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            csvImportStatus.innerHTML = '<span style="color: #667eea;">üìÇ Dosya okunuyor...</span>';

            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    let csvText = event.target.result;
                    
                    if (csvText.charCodeAt(0) === 0xFEFF) {
                        csvText = csvText.slice(1);
                    }
                    
                    const lines = csvText.split(/\r?\n|\r/).filter(line => line.trim());
                    
                    if (lines.length === 0) {
                        csvImportStatus.innerHTML = '<span style="color: #e53e3e;">‚ö†Ô∏è CSV dosyasƒ± bo≈ü!</span>';
                        return;
                    }

                    let importedCount = 0;
                    let errorCount = 0;
                    const errors = [];
                    let skippedLines = [];

                    lines.forEach((line, index) => {
                        line = line.trim();
                        if (!line) return;

                        let values;
                        if (line.includes(';')) {
                            values = line.split(';').map(v => v.trim());
                        } else if (line.includes('\t')) {
                            values = line.split('\t').map(v => v.trim());
                        } else {
                            values = line.split(',').map(v => v.trim());
                        }
                        
                        const firstValue = values[0].toLowerCase();
                        if (firstValue === '√∂ƒürenci' || firstValue === 'ad' || firstValue === 'isim' || 
                            firstValue === 'name' || firstValue === 'student' || firstValue === 'no') {
                            return;
                        }

                        if (values.length < 2) {
                            skippedLines.push(`Satƒ±r ${index + 1}: Yetersiz veri`);
                            return;
                        }

                        const studentName = values[0];
                        
                        if (!studentName || studentName.length === 0) {
                            skippedLines.push(`Satƒ±r ${index + 1}: √ñƒürenci adƒ± eksik`);
                            return;
                        }

                        const scores = values.slice(1, examSections.length + 1).map(v => {
                            if (!v || v === '') return 0;
                            const normalized = v.replace(',', '.');
                            const parsed = parseFloat(normalized);
                            return isNaN(parsed) ? 0 : parsed;
                        });

                        let isValid = true;
                        scores.forEach((score, idx) => {
                            if (idx < examSections.length && score > examSections[idx].maxScore) {
                                isValid = false;
                                errors.push(`${studentName}: B√∂l√ºm ${examSections[idx].name} puanƒ± ${examSections[idx].maxScore} deƒüerini ge√ßiyor (${score})`);
                            }
                        });

                        if (!isValid) {
                            errorCount++;
                            return;
                        }

                        if (scores.length < examSections.length) {
                            while (scores.length < examSections.length) {
                                scores.push(0);
                            }
                        } else if (scores.length > examSections.length) {
                            scores.length = examSections.length;
                        }

                        students.push({ name: studentName, scores: scores, updated: false });
                        importedCount++;
                    });

                    if (!isLocked && students.length > 0) {
                        lockFields();
                    }

                    displayStudents();
                    updateAnalysis();

                    let statusMsg = `<span style="color: #10b981;">‚úÖ ${importedCount} √∂ƒürenci ba≈üarƒ±yla i√ße aktarƒ±ldƒ±!</span>`;
                    if (errorCount > 0) {
                        statusMsg += `<br><span style="color: #f59e0b;">‚ö†Ô∏è ${errorCount} √∂ƒürenci hatalƒ± veri nedeniyle atlandƒ±</span>`;
                        if (errors.length > 0) {
                            statusMsg += `<br><span style="color: #718096; font-size: 12px;">${errors.slice(0, 3).join('<br>')}</span>`;
                        }
                    }
                    if (skippedLines.length > 0 && importedCount === 0) {
                        statusMsg += `<br><span style="color: #f59e0b;">‚ö†Ô∏è ${skippedLines.length} satƒ±r atandƒ±</span>`;
                        statusMsg += `<br><span style="color: #718096; font-size: 12px;">${skippedLines.slice(0, 3).join('<br>')}</span>`;
                        statusMsg += `<br><span style="color: #718096; font-size: 11px;">ƒ∞pucu: Dosyanƒ±zƒ±n virg√ºl (,) veya noktalƒ± virg√ºl (;) ile ayrƒ±lmƒ±≈ü olduƒüundan emin olun.</span>`;
                    }
                    csvImportStatus.innerHTML = statusMsg;

                    csvFileInput.value = '';

                } catch (error) {
                    csvImportStatus.innerHTML = '<span style="color: #e53e3e;">‚ùå CSV dosyasƒ± i≈ülenirken hata olu≈ütu! Hata: ' + error.message + '</span>';
                    console.error('CSV parse error:', error);
                }
            };

            reader.onerror = function() {
                csvImportStatus.innerHTML = '<span style="color: #e53e3e;">‚ùå Dosya okunamadƒ±!</span>';
            };

            try {
                reader.readAsText(file, 'Windows-1254');
            } catch (error) {
                reader.readAsText(file);
            }
        });

        addSectionBtn.addEventListener('click', function() {
            if (isLocked) {
                alert('√ñƒürenci bilgileri girildikten sonra b√∂l√ºm eklenemez. L√ºtfen sayfayƒ± yeniden y√ºkleyin.');
                return;
            }
            const sectionRow = document.createElement('div');
            sectionRow.className = 'section-row';
            sectionRow.innerHTML = `
                <input type="text" placeholder="B√∂l√ºm adƒ± (√∂rn. A)" class="section-name-input">
                <input type="number" placeholder="Toplam puan" class="section-score-input" min="0">
                <button class="delete-btn remove-section">Sil</button>
            `;
            sectionsContainer.appendChild(sectionRow);
            updateSectionInputs();
        });
        
        addStudentBtn.addEventListener('click', function() {
            if (isEditing) {
                updateStudent();
            } else {
                addNewStudent();
            }
        });
        
        function addNewStudent() {
            const studentName = document.getElementById('studentName').value.trim();
            if (!studentName) {
                alert('L√ºtfen √∂ƒürenci adƒ±nƒ± girin.');
                return;
            }
            const sectionScoreInputs = document.querySelectorAll('#studentSectionsContainer .student-section-score');
            const studentScores = [];
            let valid = true;
            sectionScoreInputs.forEach((input, index) => {
                const score = parseFloat(input.value) || 0;
                const maxScore = examSections[index].maxScore;
                if (score > maxScore) {
                    alert(`B√∂l√ºm ${examSections[index].name} i√ßin puan ${maxScore} deƒüerini ge√ßemez`);
                    valid = false;
                }
                studentScores.push(score);
            });
            if (!valid) return;
            const student = { name: studentName, scores: studentScores, updated: false };
            students.push(student);
            if (!isLocked) lockFields();
            displayStudents();
            updateAnalysis();
            document.getElementById('studentName').value = '';
            sectionScoreInputs.forEach(input => input.value = '');
        }

        function updateStudent() {
            const studentName = document.getElementById('studentName').value.trim();
            if (!studentName) {
                alert('L√ºtfen √∂ƒürenci adƒ±nƒ± girin.');
                return;
            }
            const sectionScoreInputs = document.querySelectorAll('#studentSectionsContainer .student-section-score');
            const studentScores = [];
            let valid = true;
            sectionScoreInputs.forEach((input, index) => {
                const score = parseFloat(input.value) || 0;
                const maxScore = examSections[index].maxScore;
                if (score > maxScore) {
                    alert(`B√∂l√ºm ${examSections[index].name} i√ßin puan ${maxScore} deƒüerini ge√ßemez`);
                    valid = false;
                }
                studentScores.push(score);
            });
            if (!valid) return;

            const originalStudent = students[editingIndex];
            const nameChanged = originalStudent.name !== studentName;
            const scoresChanged = JSON.stringify(originalStudent.scores) !== JSON.stringify(studentScores);
            
            const hasChanged = nameChanged || scoresChanged;
            
            if (hasChanged) {
                students[editingIndex].name = studentName;
                students[editingIndex].scores = studentScores;
                students[editingIndex].updated = true;
            }

            cancelEditing(); 
            displayStudents();
            updateAnalysis();
        }
        
        function startEditing(index) {
            isEditing = true;
            editingIndex = parseInt(index);
            const student = students[editingIndex];
            
            document.getElementById('studentName').value = student.name;
            const sectionScoreInputs = document.querySelectorAll('#studentSectionsContainer .student-section-score');
            sectionScoreInputs.forEach((input, i) => {
                input.value = student.scores[i] || 0;
            });
            
            addStudentBtn.textContent = '√ñƒürenciyi G√ºncelle';
            addStudentBtn.style.background = 'linear-gradient(135deg, #f97316 0%, #ea580c 100%)';
            
            document.getElementById('studentName').focus();
        }
        
        function cancelEditing() {
            isEditing = false;
            editingIndex = -1;
            
            document.getElementById('studentName').value = '';
            document.querySelectorAll('#studentSectionsContainer .student-section-score').forEach(input => input.value = '');
            
            addStudentBtn.textContent = '√ñƒürenci Ekle';
            addStudentBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
        }
        
        function updateSectionInputs() {
            examSections = [];
            const sectionRows = document.querySelectorAll('.section-row');
            sectionRows.forEach((row) => {
                const nameInput = row.querySelector('.section-name-input');
                const scoreInput = row.querySelector('.section-score-input');
                if (nameInput.value.trim() && scoreInput.value) {
                    examSections.push({
                        name: nameInput.value.trim(),
                        maxScore: parseFloat(scoreInput.value)
                    });
                }
            });
            totalExamScore = examSections.reduce((total, section) => total + section.maxScore, 0);
            document.querySelectorAll('.remove-section').forEach((btn) => {
                btn.onclick = function() {
                    if (isLocked) {
                        alert('√ñƒürenci bilgileri girildikten sonra b√∂l√ºm silinemez. L√ºtfen sayfayƒ± yeniden y√ºkleyin.');
                        return;
                    }
                    if (confirm('Bu b√∂l√ºm√º silmek istediƒüinizden emin misiniz?')) {
                        btn.closest('.section-row').remove();
                        updateSectionInputs();
                    }
                };
            });
            studentSectionsContainer.innerHTML = '';
            examSections.forEach(section => {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.innerHTML = `
                    <label>B√∂l√ºm ${section.name} Puanƒ± (maks: ${section.maxScore}):</label>
                    <input type="number" class="student-section-score" min="0" max="${section.maxScore}" placeholder="Puan girin">
                `;
                studentSectionsContainer.appendChild(div);
            });
            
            if (isEditing && editingIndex > -1) {
                const student = students[editingIndex];
                const sectionScoreInputs = document.querySelectorAll('#studentSectionsContainer .student-section-score');
                sectionScoreInputs.forEach((input, i) => {
                    input.value = student.scores[i] || 0;
                });
            }

            updateTotalScore();
        }

        function updateTotalScore() {
            totalExamScore = examSections.reduce((total, section) => total + section.maxScore, 0);
            totalScoreDisplay.textContent = `Toplam Sƒ±nav Puanƒ±: ${totalExamScore} puan`;
        }

        function displayStudents() {
            studentsList.innerHTML = '';
            students.forEach((student, index) => {
                const studentDiv = document.createElement('div');
                studentDiv.className = 'student-row';
                const totalScore = student.scores.reduce((sum, score) => sum + score, 0);
                const passingCriteria = parseFloat(passingCriteriaInput.value) || 0;
                const totalScoreClass = totalScore >= passingCriteria ? 'student-total passed' : 'student-total failed';
                
                let scoresHtml = '';
                student.scores.forEach((score, i) => {
                    const sectionName = examSections[i] ? examSections[i].name : 'B√∂l√ºm';
                    scoresHtml += `<span>${sectionName}: ${score}</span><br>`;
                });
                
                const updatedText = student.updated ? `<div class="updated-tag">*g√ºncellendi</div>` : '';

                studentDiv.innerHTML = `
                    <div class="student-name">${student.name}</div>
                    <div class="student-scores">${scoresHtml}</div>
                    ${updatedText} 
                    <div class="${totalScoreClass}">${totalScore} / ${totalExamScore}</div>
                    <button class="delete-btn remove-student" data-index="${index}">Sil</button>
                    <button class="edit-btn" data-index="${index}">D√ºzenle</button>
                `;
                studentsList.appendChild(studentDiv);
            });

            document.querySelectorAll('.remove-student').forEach(btn => {
                btn.onclick = function() {
                    if (confirm('Bu √∂ƒürenciyi silmek istediƒüinizden emin misiniz?')) {
                        const index = parseInt(this.getAttribute('data-index'));
                        
                        if (isEditing && editingIndex === index) {
                            cancelEditing();
                        }

                        students.splice(index, 1);
                        if (students.length === 0) unlockFields();
                        displayStudents();
                        updateAnalysis();
                    }
                };
            });

            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.onclick = function() {
                    startEditing(this.getAttribute('data-index'));
                };
            });
        }

        function lockFields() {
            isLocked = true;
            passingCriteriaInput.disabled = true;
            passingCriteriaInput.classList.add('locked');
            document.querySelectorAll('.section-name-input, .section-score-input').forEach(input => {
                input.disabled = true;
                input.classList.add('locked');
            });
            document.querySelectorAll('.remove-section').forEach(btn => {
                btn.disabled = true;
                btn.classList.add('locked');
            });
            addSectionBtn.disabled = true;
            addSectionBtn.classList.add('locked');
            document.getElementById('lockWarningBanner').style.display = 'block';
        }

        function unlockFields() {
            isLocked = false;
            passingCriteriaInput.disabled = false;
            passingCriteriaInput.classList.remove('locked');
            document.querySelectorAll('.section-name-input, .section-score-input').forEach(input => {
                input.disabled = false;
                input.classList.remove('locked');
            });
            document.querySelectorAll('.remove-section').forEach(btn => {
                btn.disabled = false;
                btn.classList.remove('locked');
            });
            addSectionBtn.disabled = false;
            addSectionBtn.classList.remove('locked');
            document.getElementById('lockWarningBanner').style.display = 'none';
        }

        function updateAnalysis() {
            if (students.length === 0) {
                document.getElementById('classAverage').textContent = '0.00';
                document.getElementById('medianScore').textContent = '0.00';
                document.getElementById('stdDeviation').textContent = '0.00';
                document.getElementById('passRate').textContent = '0.00%';
                document.getElementById('passRate').classList.remove('low-pass-rate');
                document.getElementById('totalStudents').textContent = '0';
                document.getElementById('successfulStudents').textContent = '0';
                document.getElementById('unsuccessfulStudents').textContent = '0';
                document.getElementById('scoreRange').textContent = '0.00';
                document.getElementById('highestScore').textContent = '0.00';
                document.getElementById('lowestScore').textContent = '0.00';
                document.getElementById('hardestSection').textContent = '-';
                document.getElementById('easiestSection').textContent = '-';
                document.getElementById('sectionAveragesList').innerHTML = '';
                document.getElementById('autoEvaluation').innerHTML = '<em style="color: var(--text-tertiary);">Otomatik deƒüerlendirme olu≈üturmak i√ßin √∂ƒürenci ekleyin...</em>';
                return;
            }
            const totalScores = students.map(student => student.scores.reduce((sum, score) => sum + score, 0));
            const classAverage = totalScores.reduce((sum, score) => sum + score, 0) / students.length;
            document.getElementById('classAverage').textContent = classAverage.toFixed(2);
            const sortedScores = [...totalScores].sort((a, b) => a - b);
            let median;
            if (sortedScores.length % 2 === 0) {
                median = (sortedScores[sortedScores.length / 2 - 1] + sortedScores[sortedScores.length / 2]) / 2;
            } else {
                median = sortedScores[Math.floor(sortedScores.length / 2)];
            }
            document.getElementById('medianScore').textContent = median.toFixed(2);
            const variance = totalScores.reduce((sum, score) => sum + Math.pow(score - classAverage, 2), 0) / students.length;
            const stdDeviation = Math.sqrt(variance);
            document.getElementById('stdDeviation').textContent = stdDeviation.toFixed(2);
            const passingCriteria = parseFloat(passingCriteriaInput.value) || 0;
            const passedStudents = totalScores.filter(score => score >= passingCriteria).length;
            const failedStudents = students.length - passedStudents;
            const passRate = (passedStudents / students.length) * 100;
            document.getElementById('passRate').textContent = passRate.toFixed(2) + '%';
            document.getElementById('successfulStudents').textContent = passedStudents;
            document.getElementById('unsuccessfulStudents').textContent = failedStudents;
            if (passRate < ((passingCriteria / totalExamScore) * 100)) {
                document.getElementById('passRate').classList.add('low-pass-rate');
            } else {
                document.getElementById('passRate').classList.remove('low-pass-rate');
            }
            document.getElementById('totalStudents').textContent = students.length;
            const highestScore = Math.max(...totalScores);
            const lowestScore = Math.min(...totalScores);
            const scoreRange = highestScore - lowestScore;
            document.getElementById('highestScore').textContent = highestScore.toFixed(2);
            document.getElementById('lowestScore').textContent = lowestScore.toFixed(2);
            document.getElementById('scoreRange').textContent = scoreRange.toFixed(2);
            const sectionAveragesList = document.getElementById('sectionAveragesList');
            sectionAveragesList.innerHTML = '';
            let hardestSection = null;
            let easiestSection = null;
            let lowestPercentage = 100;
            let highestPercentage = 0;
            examSections.forEach((section, index) => {
                const sectionScores = students.map(student => student.scores[index]);
                const sectionAverage = sectionScores.reduce((sum, score) => sum + score, 0) / sectionScores.length;
                const sectionPercentage = (sectionAverage / section.maxScore) * 100;
                if (sectionPercentage < lowestPercentage) {
                    lowestPercentage = sectionPercentage;
                    hardestSection = { name: section.name, percentage: sectionPercentage };
                }
                if (sectionPercentage > highestPercentage) {
                    highestPercentage = sectionPercentage;
                    easiestSection = { name: section.name, percentage: sectionPercentage };
                }
                const sectionAverageItem = document.createElement('div');
                sectionAverageItem.className = 'section-average-item';
                sectionAverageItem.innerHTML = `
                    <span class="section-name">B√∂l√ºm ${section.name}</span>
                    <span>${sectionAverage.toFixed(2)} / ${section.maxScore} (%${sectionPercentage.toFixed(1)})</span>
                `;
                sectionAveragesList.appendChild(sectionAverageItem);
            });
            if (hardestSection) {
                document.getElementById('hardestSection').textContent = `${hardestSection.name} (%${hardestSection.percentage.toFixed(1)})`;
            }
            if (easiestSection) {
                document.getElementById('easiestSection').textContent = `${easiestSection.name} (%${easiestSection.percentage.toFixed(1)})`;
            }
            generateEvaluation(classAverage, median, passRate, highestScore, lowestScore, scoreRange, hardestSection, easiestSection, stdDeviation, passedStudents, failedStudents, passingCriteria);
        }

        function generateEvaluation(classAvg, median, passRate, highest, lowest, range, hardest, easiest, stdDev, passedCount, failedCount, passingCriteria) {
            const evaluationDiv = document.getElementById('autoEvaluation');
            if (students.length === 0) {
                evaluationDiv.innerHTML = '<em style="color: var(--text-tertiary);">Otomatik deƒüerlendirme olu≈üturmak i√ßin √∂ƒürenci ekleyin...</em>';
                return;
            }
            const avgPercentage = (classAvg / totalExamScore) * 100;
            const medianPercentage = (median / totalExamScore) * 100;
            const passingCriteriaPercentage = (passingCriteria / totalExamScore) * 100;
            let evaluation = '';
            if (avgPercentage >= 85) {
                evaluation += `Sƒ±nƒ±f, ${totalExamScore} √ºzerinden ${classAvg.toFixed(2)} ortalama (%${avgPercentage.toFixed(1)}) ile <strong>m√ºkemmel bir performans</strong> sergilemi≈ütir. `;
            } else if (avgPercentage >= 70) {
                evaluation += `Sƒ±nƒ±f, ${totalExamScore} √ºzerinden ${classAvg.toFixed(2)} ortalama (%${avgPercentage.toFixed(1)}) ile <strong>iyi bir performans</strong> g√∂stermi≈ütir. `;
            } else if (avgPercentage >= 50) {
                evaluation += `Sƒ±nƒ±f, ${totalExamScore} √ºzerinden ${classAvg.toFixed(2)} ortalama (%${avgPercentage.toFixed(1)}) ile <strong>orta d√ºzey bir performans</strong> sergilemi≈ütir. `;
            } else {
                evaluation += `Sƒ±nƒ±f, ${totalExamScore} √ºzerinden ${classAvg.toFixed(2)} ortalama (%${avgPercentage.toFixed(1)}) ile <strong>ortalamanƒ±n altƒ±nda bir performans</strong> g√∂stermi≈ütir. `;
            }
            const avgMedianDiff = Math.abs(classAvg - median);
            if (avgMedianDiff < totalExamScore * 0.05) {
                evaluation += `Medyan deƒüeri ${median.toFixed(2)} (%${medianPercentage.toFixed(1)}) olup, ortalamaya √ßok yakƒ±ndƒ±r, bu da dengeli bir daƒüƒ±lƒ±m olduƒüunu g√∂sterir. `;
            } else if (median > classAvg) {
                evaluation += `Medyan deƒüeri ${median.toFixed(2)} (%${medianPercentage.toFixed(1)}) ortalamanƒ±n √ºzerinde olup, d√º≈ü√ºk performans g√∂steren az sayƒ±da √∂ƒürencinin ortalamayƒ± a≈üaƒüƒ± √ßektiƒüini g√∂stermektedir. `;
            } else {
                evaluation += `Medyan deƒüeri ${median.toFixed(2)} (%${medianPercentage.toFixed(1)}) ortalamanƒ±n altƒ±nda olup, y√ºksek performans g√∂steren az sayƒ±da √∂ƒürencinin ortalamayƒ± yukarƒ± √ßektiƒüini g√∂stermektedir. `;
            }
            evaluation += `Toplam ${students.length} √∂ƒürenciden <strong>${passedCount} √∂ƒürenci ba≈üarƒ±lƒ±</strong>, <strong>${failedCount} √∂ƒürenci ba≈üarƒ±sƒ±z</strong> olmu≈ütur. `;
            if (passRate >= passingCriteriaPercentage) {
                evaluation += `<strong>%${passRate.toFixed(1)} ba≈üarƒ± oranƒ±</strong> ile sƒ±nƒ±f, ${passingCriteria} puanlƒ±k ge√ßme kriterini kar≈üƒ±lamƒ±≈ü olup, √∂ƒürencilerin √ßoƒüunun ders i√ßeriƒüini ba≈üarƒ±yla kavradƒ±ƒüƒ±nƒ± g√∂stermektedir. `;
            } else {
                evaluation += `<strong>%${passRate.toFixed(1)} ba≈üarƒ± oranƒ±</strong>, ${passingCriteria} puanlƒ±k ge√ßme kriterinin altƒ±nda kalmƒ±≈ü olup, √∂nemli sayƒ±da √∂ƒürencinin konularƒ± kavramakta zorlandƒ±ƒüƒ±nƒ± ve ek desteƒüe ihtiya√ß duyabileceƒüini g√∂stermektedir. `;
            }
            evaluation += `En d√º≈ü√ºk ${lowest.toFixed(2)} ve en y√ºksek ${highest.toFixed(2)} puanlar arasƒ±nda ${range.toFixed(2)} puanlƒ±k bir <strong>a√ßƒ±klƒ±k (range)</strong> bulunmaktadƒ±r. `;
            if (stdDev < totalExamScore * 0.15) {
                evaluation += `${stdDev.toFixed(2)} standart sapma deƒüeri, sƒ±nƒ±f genelinde <strong>tutarlƒ± bir performans</strong> olduƒüunu g√∂stermektedir. `;
            } else if (stdDev < totalExamScore * 0.25) {
                evaluation += `${stdDev.toFixed(2)} standart sapma deƒüeri, √∂ƒürenci performansƒ±nda <strong>orta d√ºzey bir deƒüi≈ükenlik</strong> olduƒüunu g√∂stermektedir. `;
            } else {
                evaluation += `${stdDev.toFixed(2)} standart sapma deƒüeri, √∂ƒürenci performansƒ±nda <strong>√∂nemli bir farklƒ±lƒ±k</strong> olduƒüunu ortaya koymaktadƒ±r. `;
            }
            if (range > totalExamScore * 0.5) {
                evaluation += `Geni≈ü puan a√ßƒ±klƒ±ƒüƒ±, sƒ±nƒ±fta farklƒ± ba≈üarƒ± seviyelerinde √∂ƒürencilerin bulunduƒüunu ve farklƒ±la≈ütƒ±rƒ±lmƒ±≈ü √∂ƒüretim yakla≈üƒ±mlarƒ±na ihtiya√ß duyulabileceƒüini g√∂stermektedir. `;
            }
            if (hardest && easiest) {
                evaluation += `<strong>${hardest.name}</strong> b√∂l√ºm√º %${hardest.percentage.toFixed(1)} ortalamayla en zorlayƒ±cƒ± b√∂l√ºm olurken, <strong>${easiest.name}</strong> b√∂l√ºm√º %${easiest.percentage.toFixed(1)} ile en kolay b√∂l√ºm olmu≈ütur. `;
                if (hardest.percentage < 60) {
                    evaluation += `<strong>√ñneri:</strong> ${hardest.name} b√∂l√ºm√ºndeki i√ßeriƒüin tekrar g√∂zden ge√ßirilmesi √∂nerilmektedir √ß√ºnk√º √∂ƒürenciler bu konuda √∂nemli zorluklar ya≈üamƒ±≈ütƒ±r. Ek alƒ±≈ütƒ±rma oturumlarƒ±, destekleyici materyaller veya alternatif √∂ƒüretim yakla≈üƒ±mlarƒ± faydalƒ± olabilir. `;
                } else if (hardest.percentage < 70) {
                    evaluation += `<strong>√ñneri:</strong> ${hardest.name} b√∂l√ºm√º, √∂ƒürenci anlayƒ±≈üƒ±nƒ± g√º√ßlendirmek i√ßin ek tekrar veya alƒ±≈ütƒ±rma √ßalƒ±≈ümalarƒ±ndan faydalanabilir. `;
                }
                if (passRate < passingCriteriaPercentage) {
                    if (failedCount > students.length / 3) {
                        evaluation += `Ba≈üarƒ±sƒ±z √∂ƒürenci sayƒ±sƒ±nƒ±n y√ºksek olmasƒ± (${failedCount} √∂ƒürenci), kapsamlƒ± bir m√ºdahale stratejisi gerektirmektedir. Telafi oturumlarƒ± d√ºzenlenmesi, k√º√ß√ºk grup √ßalƒ±≈ümalarƒ± ve birebir destek saƒülanmasƒ± d√º≈ü√ºn√ºlebilir. `;
                    } else {
                        evaluation += `Ba≈üarƒ±sƒ±z √∂ƒürenciler (${failedCount} √∂ƒürenci) i√ßin hedeflenmi≈ü destek programlarƒ± ve ek √ßalƒ±≈üma materyalleri sunulmasƒ± √∂nerilmektedir. `;
                    }
                } else if (passRate >= 90 && avgPercentage >= 85) {
                    evaluation += `Y√ºksek ba≈üarƒ± oranƒ± ve g√º√ßl√º ortalama, etkili √∂ƒüretim ve iyi √∂ƒürenci katƒ±lƒ±mƒ±nƒ± g√∂stermektedir. Mevcut √∂ƒüretim stratejilerine devam edilmeli, ancak √ºst d√ºzey √∂ƒürenciler i√ßin zenginle≈ütirme aktiviteleri d√º≈ü√ºn√ºlebilir. `;
                }
            }
            evaluationDiv.innerHTML = evaluation;
        }

        document.addEventListener('input', function(e) {
            if (e.target.classList.contains('section-name-input') || e.target.classList.contains('section-score-input')) {
                if (!isLocked) {
                    updateSectionInputs();
                    updateAnalysis();
                }
            }
            if (e.target.id === 'passingCriteria') {
                const value = parseFloat(e.g.value);
                if (value < 0) {
                    passingCriteriaError.textContent = 'Ge√ßme kriteri 0 veya daha b√ºy√ºk bir sayƒ± olmalƒ±dƒ±r';
                } else {
                    passingCriteriaError.textContent = '';
                }
                if (!isLocked) {
                    updateAnalysis();
                }
            }
        });
    </script>
</body>
</html>